<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Books - WENLIB</title>
    <link rel="icon" href="./assets/peng.ico">
    <link rel="stylesheet" href="./css/style.css">
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar">
        <h1 id="navlogo">WENLIB</h1>
        <ul>
            <li><a href="index.html">HOME</a></li>
            <li><a href="index.html#about">ABOUT</a></li>
            <li><a href="library.html">BOOKS</a></li>
            <li><a href="index.html#contact">CONTACT</a></li>
        </ul>
        <div id="real-time" class="time-display"></div>
    </nav>

    <!-- Main Content -->
    <main class="content">
        <section id="books" class="section">
            <h1>Books</h1>
            <div class="filter-container">
                <div class="dropdown-container">
                    <span class="tag-label">TAG</span>
                    <select id="cate" name="cate" class="custom-dropdown">
                        <option value="all">All</option>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Cyber Security">Cyber Security</option>
                        <option value="Mathematics">Mathematics</option>
                    </select>
                </div>
                <div class="search-container">
                    <input type="text" id="search-input" placeholder="Search by title or author..." class="search-bar">
                    <button id="search-button" class="search-button">Search</button>
                </div>
            </div>

            <!-- Book's list -->
            <div id="book-list" class="book-list">
                <!-- Book listing here -->
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; <span id="current-year"></span> WENLIB. All rights reserved.</p>
        <p>Today is <span id="current-date"></span></p>
    </footer>

    <!-- JavaScript -->
    <script>

        async function fetchBooks() {
            try {
                const response = await fetch('./json/books.json');
                const books = await response.json();
                return books;
            } catch (error) {
                console.error("Error fetching books:", error);
                return [];
            }
        }


        function displayBooks(books, searchQuery = '', category = 'all') {
            const bookList = document.getElementById("book-list");
            bookList.innerHTML = "";

            const filteredBooks = books.filter(book => {
                const matchesCategory = category === 'all' || book.tag === category;
                const matchesSearch = searchQuery === '' ||
                    book.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    book.author.toLowerCase().includes(searchQuery.toLowerCase());
                return matchesCategory && matchesSearch;
            });

            filteredBooks.forEach(book => {
                const bookItem = document.createElement("div");
                bookItem.className = "book-item";
                bookItem.innerHTML = `
                    <h3>${book.title}</h3>
                    <p><strong>Author:</strong> ${book.author}</p>
                    <p><strong>Description:</strong> ${book.description}</p>
                    <p><strong>Tag:</strong> ${book.tag}</p>
                    <img src="${book.image}" alt="${book.title}" style="max-width: 200px;">
                `;
                bookItem.addEventListener('click', () => {
                    const queryParams = new URLSearchParams({
                        title: book.title,
                        author: book.author,
                        description: book.description,
                        tag: book.tag,
                        image: book.image,
                        link: book.link || "#"
                    });
                    window.location.href = `book.html?${queryParams.toString()}`;
                });
                bookList.appendChild(bookItem);
            });
        }


        fetchBooks().then(books => displayBooks(books));


        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const categoryDropdown = document.getElementById('cate');

        searchButton.addEventListener('click', () => {
            const searchQuery = searchInput.value.trim();
            const selectedCategory = categoryDropdown.value;
            fetchBooks().then(books => displayBooks(books, searchQuery, selectedCategory));
        });


        categoryDropdown.addEventListener('change', () => {
            const searchQuery = searchInput.value.trim();
            const selectedCategory = categoryDropdown.value;
            fetchBooks().then(books => displayBooks(books, searchQuery, selectedCategory));
        });
    </script>
    <script src="./js/main.js"></script>
</body>

</html>